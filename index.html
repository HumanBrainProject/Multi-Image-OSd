<div id="openseadragon1" style="width: 100%; height: 100%;"></div>
<script src="openseadragon.min.js"></script>
<script type="text/javascript">

    const BUCKET = getUrlParamValue('bucket');
    const COLLECTION_MODE = getUrlParamValue('collectionMode');
    const COLLECTION_ROWS = getUrlParamValue('collectionRows');

    if (!BUCKET) alert("No bucket provided");

    let headers = new Headers();
    headers.append("Accept", "application/json");

    let path = BUCKET;
    if(!path.endsWith("/")) path = path + "/";

    fetch(path + "?delimiter=/", {headers})
    .then(response => response.json())
    .then(value => {
        var dzis = [];
        for(let dir of value) {
            dir = dir.subdir;
            if(dir) {
                let name = dir.substring(0, dir.lastIndexOf("."));
                let url = path + dir + name + ".dzi";
                console.log(url);
                dzis.push(url);
            }
        }

        var viewer = OpenSeadragon({
            id: "openseadragon1",
            prefixUrl: "images/",
            sequenceMode: true,
            showReferenceStrip: true,
            collectionMode: COLLECTION_MODE,
            collectionRows: COLLECTION_ROWS,
            tileSources: dzis
        });
    });
       
    function getUrlParamValue(paramName) {
        return (new URL(window.location)).searchParams.get(paramName);
    }

</script>
